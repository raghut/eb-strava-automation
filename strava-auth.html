<!DOCTYPE html>
<html>
<head>
  <title>Strava Token Auto-Saver</title>
</head>
<body>
  <h2>Authorizing with Strava...</h2>
  <p id="status">Please wait...</p>

  <script>
    async function exchangeAndSaveToken() {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      const webhookURL = "https://script.google.com/macros/s/AKfycbyTtl2WLe37XxgWXqtStvZS_DAMmdMqg5mVjYbRMNcJiCH2fmM4guXJYOm3Zh1LZ66bgQ/exec";

      if (!code) {
        document.getElementById("status").textContent = "Missing 'code' parameter.";
        return;
      }

      try {
        const tokenResponse = await fetch("https://www.strava.com/oauth/token", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            client_id: "YOUR_CLIENT_ID",
            client_secret: "YOUR_CLIENT_SECRET",
            code: code,
            grant_type: "authorization_code"
          })
        });

        const data = await tokenResponse.json();
        console.info("tokenResponse", data);

        await fetch(webhookURL, {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        });

        document.getElementById("status").textContent = "✅ Token saved! You can close this tab.";
      } catch (err) {
        document.getElementById("status").textContent = "❌ Error saving token.";
        console.error(err);
      }
    }

    exchangeAndSaveToken();
  </script>
</body>
</html>